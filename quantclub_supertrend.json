{
  "code": 200,
  "data": {
    "description": "",
    "html": "<html><head><meta name=\"color-scheme\" content=\"light dark\"></head><body><pre style=\"word-wrap: break-word; white-space: pre-wrap;\">import numpy as np\r\nimport pandas as pd\r\n\r\ndef calculate_supertrend(data, atr_period, factor):\r\n    \"\"\"\r\n    Calculate the Supertrend indicator for financial time series data.\r\n\r\n    The Supertrend is a trend-following indicator that uses the Average True Range (ATR) \r\n    and price action to identify the direction of the trend and potential reversals.\r\n\r\n    Parameters:\r\n    -----------\r\n    data : pandas.DataFrame\r\n        A DataFrame containing the time series data with columns: 'high', 'low', and 'close'.\r\n    atr_period : int\r\n        The period for calculating the Average True Range (ATR).\r\n    factor : float\r\n        The multiplier for the ATR used to calculate the upper and lower bands.\r\n\r\n    Returns:\r\n    --------\r\n    pandas.DataFrame\r\n        The input DataFrame with additional columns:\r\n        - 'prev_close': Previous close price.\r\n        - 'tr': True range for each period.\r\n        - 'ATR': Average True Range over the specified period.\r\n        - 'hl2': Midpoint of the high and low prices.\r\n        - 'upper_band': Upper band of the Supertrend.\r\n        - 'lower_band': Lower band of the Supertrend.\r\n        - 'supertrend_l': Supertrend values for the trend direction.\r\n        - 'supertrend_s': Smoothed Supertrend values.\r\n\r\n    Example:\r\n    --------\r\n    >>> data = pd.DataFrame({\r\n    >>>     'high': [110, 112, 115],\r\n    >>>     'low': [105, 107, 110],\r\n    >>>     'close': [108, 111, 114]\r\n    >>> })\r\n    >>> atr_period = 7\r\n    >>> factor = 3\r\n    >>> result = calculate_supertrend(data, atr_period, factor)\r\n    >>> print(result)\r\n\r\n    References:\r\n    -----------\r\n    - Supertrend Indicator: https://www.investopedia.com/terms/s/supertrend.asp\r\n\r\n    \"\"\"\r\n    df = data.copy()\r\n    high = df['high']\r\n    low = df['low']\r\n    close = df['close']\r\n\r\n    # Calculate previous close, true range, and Average True Range (ATR)\r\n    df['prev_close'] = close.shift(1)\r\n    df['tr'] = np.maximum((high - low), \r\n                          np.maximum(np.abs(high - df['prev_close']), \r\n                                     np.abs(low - df['prev_close'])))\r\n    df['ATR'] = df['tr'].rolling(window=atr_period).mean()\r\n\r\n    # Calculate upper and lower bands\r\n    df['hl2'] = (df['high'] + df['low']) / 2\r\n    df['upper_band'] = df['hl2'] + factor * df['ATR']\r\n    df['lower_band'] = df['hl2'] - factor * df['ATR']\r\n\r\n    # Initialize Supertrend columns\r\n    df['supertrend_l'] = 0.0\r\n\r\n    # Column index for faster computation\r\n    idx_supertrend = df.columns.get_loc('supertrend_l')\r\n    idx_upband = df.columns.get_loc('upper_band')\r\n    idx_lowband = df.columns.get_loc('lower_band')\r\n    idx_close = df.columns.get_loc('close')\r\n\r\n    # Set initial Supertrend value\r\n    df.iloc[0, idx_supertrend] = df['upper_band'].iloc[0]\r\n\r\n    # Calculate Supertrend values\r\n    for index in range(1, len(df)):\r\n        if df.iloc[index, idx_close] > df.iloc[index - 1, idx_supertrend]:\r\n            df.iloc[index, idx_supertrend] = df.iloc[index, idx_upband]\r\n        else:\r\n            df.iloc[index, idx_supertrend] = df.iloc[index, idx_lowband]\r\n\r\n    # Add smoothed Supertrend column\r\n    df['supertrend_s'] = df['supertrend_l']\r\n\r\n    return df\r\n \r\n</pre></body></html>",
    "title": "",
    "url": "https://raw.githubusercontent.com/the-quantclub-iitbhu/Technical-indicators/main/supertrend.py",
    "usage": {
      "tokens": 852
    }
  },
  "meta": {
    "usage": {
      "tokens": 852
    }
  },
  "status": 20000
}